"use strict";

;

function form_focus(form) {
  var inputs = form.querySelectorAll('input[type="text"]');
  inputs.forEach(function (item) {
    item.onfocus = function () {
      item.parentNode.classList.add('focus');
      item.parentNode.classList.remove('_error');
    };

    item.onblur = function () {
      if (item.value.length >= 1) {
        item.parentNode.classList.add('focus');
      } else {
        item.parentNode.classList.remove('focus');
      }
    };
  });
} // вызов функции


function forms() {
  var join = document.querySelector('.join__form');
  var create = document.querySelector('.create__form');
  form_focus(join);
  form_focus(create);
}

forms();
;
var pages = {
  base: true,
  game: false,
  create: false,
  join: false,
  waiting: false
};

var locationResolver = function locationResolver(location) {
  switch (location) {
    case "/":
      pageActive(location);
      break;

    case "#/create":
      pageActive(location);
      break;

    case "#/join":
      pageActive(location);
      break;

    case "#/waiting":
      pageActive(location);
      break;

    case "#/game":
      pageActive(location);
      break;
  }
};

function checkHash() {
  var location = window.location.hash;

  if (location) {
    locationResolver(location);
  }

  if (window.location.hash == "" || window.location.hash == "/") {
    var base_page = document.querySelector(".base");

    for (var item in pages) {
      var page = document.querySelector(".".concat(item));

      if (page == base_page) {
        page.style.display = 'block';
      } else {
        page.style.display = 'none';
      }
    }
  }
}

window.onload = function () {
  checkHash();
}; // hash watcher


window.onhashchange = function () {
  setTimeout(function () {
    checkHash();
  }, 100);
};

function pageActive(location) {
  var name = location.substr(2);
  var page_active = document.querySelector(".".concat(name));

  for (var item in pages) {
    var page = document.querySelector(".".concat(item));

    if (page == page_active) {
      page.style.display = 'block';
    } else {
      page.style.display = 'none';
    }
  }
} // btn - back


var btns_back = document.querySelectorAll('.back');
btns_back.forEach(function (btn) {
  btn.onclick = function () {
    window.location.hash = '';
  };
});
;

function wating_get() {
  var baseURL = 'http://3.122.206.63/api/v1/game_info'; //const baseURL = 'https://jsonplaceholder.typicode.com/posts';

  function sendRequest(method, url) {
    var body = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      xhr.open(method, url);
      xhr.responseType = 'json';
      xhr.setRequestHeader('Content-Type', 'application/json');

      xhr.onload = function () {
        if (xhr.status >= 400) {
          reject(xhr.response);
        } else {
          resolve(xhr.response);
        }
      };

      xhr.onerror = function () {
        reject(xhr.response);
      };

      xhr.send(JSON.stringify(body));
    });
  }

  var body = {
    room_id: localStorage.getItem('room_id')
  };
  console.log(localStorage.getItem('room_id'));

  function send_req() {
    sendRequest('GET', baseURL, body).then(function (data) {
      return console.log(data);
    })["catch"](function (err) {
      console.log(err);
    });
  }

  function next_page(data) {
    if (data.message == "Successfully created") {
      window.location.hash = '#/waiting';
    }
  }

  var start = document.querySelector('.start-game');
  start.addEventListener('click', formSend);

  function formSend(e) {
    e.preventDefault();
    send_req();
  }

  function formClear(item) {
    item.value = '';
    var el_style = item.parentNode;
    el_style.classList.remove('focus');
  }
}

wating_get();
;

function form_create() {
  var baseURL = 'http://3.122.206.63/api/v1/room_create'; //const baseURL = 'https://jsonplaceholder.typicode.com/posts';

  function sendRequest(method, url) {
    var body = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      xhr.open(method, url);
      xhr.responseType = 'json';
      xhr.setRequestHeader('Content-Type', 'application/json');

      xhr.onload = function () {
        if (xhr.status >= 400) {
          reject(xhr.response);
        } else {
          resolve(xhr.response);
          next_page(xhr.response);
        }
      };

      xhr.onerror = function () {
        reject(xhr.response);
      };

      xhr.send(JSON.stringify(body));
    });
  }

  var body = {
    initiator: '',
    password: '',
    location: '',
    quantity_players: ''
  };

  function send_req() {
    sendRequest('POST', baseURL, body).then(function (data) {
      return console.log(data);
    })["catch"](function (err) {
      console.log(err);
    });
  }

  function next_page(data) {
    if (data.message == "Successfully created") {
      window.location.hash = '#/waiting';
      localStorage.setItem('room_id', "".concat(data.room_id));
      localStorage.setItem('password', "".concat(data.password));
    }
  }

  var form = document.querySelector('.create__form');
  form.addEventListener('submit', formSend);

  function formSend(e) {
    e.preventDefault();
    form.querySelectorAll('input[type="text"]').forEach(function (item, i) {
      for (var inp in body) {
        if (item.classList.contains(inp)) {
          body[inp] = item.value;
        }
      }

      formClear(item);
    });
    send_req();
  }

  function formClear(item) {
    item.value = '';
    var el_style = item.parentNode;
    el_style.classList.remove('focus');
  }
}

form_create();
;

function form_join() {
  var baseURL = 'http://3.122.206.63/api/v1/room_connect';

  function sendRequest(method, url) {
    var body = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      xhr.open(method, url);
      xhr.responseType = 'json';
      xhr.setRequestHeader('Content-Type', 'application/json');

      xhr.onload = function () {
        if (xhr.status >= 400) {
          reject(xhr.response);
        } else {
          resolve(xhr.response);
          next_page(xhr.response);
        }
      };

      xhr.onerror = function () {
        reject(xhr.response);
      };

      xhr.send(JSON.stringify(body));
    });
  }

  var body = {
    nickname: '',
    password: '',
    room: ''
  };

  function send_req() {
    sendRequest('POST', baseURL, body).then(function (data) {
      return console.log(data);
    })["catch"](function (err) {
      console.log(err);
    });
  }

  function next_page(data) {
    if (data.message == "Successfully created") {
      window.location.hash = '#/waiting';
    }
  }

  var form = document.querySelector('.join__form');
  form.addEventListener('submit', formSend);

  function formSend(e) {
    e.preventDefault();
    form.querySelectorAll('input[type="text"]').forEach(function (item, i) {
      for (var inp in body) {
        if (item.classList.contains(inp)) {
          body[inp] = item.value;
        }
      }

      formClear(item);
    });
    send_req();
  }

  function formClear(item) {
    item.value = '';
    var el_style = item.parentNode;
    el_style.classList.remove('focus');
  }
}

form_join();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJibG9ja3MvZm9ybV9mb2N1cy5qcyIsImJsb2Nrcy9teVJvdXRlci5qcyIsImJsb2Nrcy9zZW5kX3JlcS5qcyIsImJsb2Nrcy9HRVQvd2F0aW5nLmpzIiwiYmxvY2tzL1BPU1QvZm9ybV9jcmVhdGUuanMiLCJibG9ja3MvUE9TVC9mb3JtX2pvaW4uanMiXSwibmFtZXMiOlsiZm9ybV9mb2N1cyIsImZvcm0iLCJpbnB1dHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJvbmZvY3VzIiwicGFyZW50Tm9kZSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsIm9uYmx1ciIsInZhbHVlIiwibGVuZ3RoIiwiZm9ybXMiLCJqb2luIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlIiwicGFnZXMiLCJiYXNlIiwiZ2FtZSIsIndhaXRpbmciLCJsb2NhdGlvblJlc29sdmVyIiwibG9jYXRpb24iLCJwYWdlQWN0aXZlIiwiY2hlY2tIYXNoIiwid2luZG93IiwiaGFzaCIsImJhc2VfcGFnZSIsInBhZ2UiLCJzdHlsZSIsImRpc3BsYXkiLCJvbmxvYWQiLCJvbmhhc2hjaGFuZ2UiLCJzZXRUaW1lb3V0IiwibmFtZSIsInN1YnN0ciIsInBhZ2VfYWN0aXZlIiwiYnRuc19iYWNrIiwiYnRuIiwib25jbGljayIsIndhdGluZ19nZXQiLCJiYXNlVVJMIiwic2VuZFJlcXVlc3QiLCJtZXRob2QiLCJ1cmwiLCJib2R5IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJyZXNwb25zZVR5cGUiLCJzZXRSZXF1ZXN0SGVhZGVyIiwic3RhdHVzIiwicmVzcG9uc2UiLCJvbmVycm9yIiwic2VuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJyb29tX2lkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImNvbnNvbGUiLCJsb2ciLCJzZW5kX3JlcSIsInRoZW4iLCJkYXRhIiwiZXJyIiwibmV4dF9wYWdlIiwibWVzc2FnZSIsInN0YXJ0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImZvcm1TZW5kIiwiZSIsInByZXZlbnREZWZhdWx0IiwiZm9ybUNsZWFyIiwiZWxfc3R5bGUiLCJmb3JtX2NyZWF0ZSIsImluaXRpYXRvciIsInBhc3N3b3JkIiwicXVhbnRpdHlfcGxheWVycyIsInNldEl0ZW0iLCJpIiwiaW5wIiwiY29udGFpbnMiLCJmb3JtX2pvaW4iLCJuaWNrbmFtZSIsInJvb20iXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FDQUEsU0FBQUEsVUFBQSxDQUFBQyxJQUFBLEVBQUE7QUFDQSxNQUFBQyxNQUFBLEdBQUFELElBQUEsQ0FBQUUsZ0JBQUEsQ0FBQSxvQkFBQSxDQUFBO0FBRUFELEVBQUFBLE1BQUEsQ0FBQUUsT0FBQSxDQUFBLFVBQUFDLElBQUEsRUFBQTtBQUNBQSxJQUFBQSxJQUFBLENBQUFDLE9BQUEsR0FBQSxZQUFBO0FBQ0FELE1BQUFBLElBQUEsQ0FBQUUsVUFBQSxDQUFBQyxTQUFBLENBQUFDLEdBQUEsQ0FBQSxPQUFBO0FBQ0FKLE1BQUFBLElBQUEsQ0FBQUUsVUFBQSxDQUFBQyxTQUFBLENBQUFFLE1BQUEsQ0FBQSxRQUFBO0FBQ0EsS0FIQTs7QUFLQUwsSUFBQUEsSUFBQSxDQUFBTSxNQUFBLEdBQUEsWUFBQTtBQUNBLFVBQUFOLElBQUEsQ0FBQU8sS0FBQSxDQUFBQyxNQUFBLElBQUEsQ0FBQSxFQUFBO0FBQ0FSLFFBQUFBLElBQUEsQ0FBQUUsVUFBQSxDQUFBQyxTQUFBLENBQUFDLEdBQUEsQ0FBQSxPQUFBO0FBQ0EsT0FGQSxNQUVBO0FBQ0FKLFFBQUFBLElBQUEsQ0FBQUUsVUFBQSxDQUFBQyxTQUFBLENBQUFFLE1BQUEsQ0FBQSxPQUFBO0FBQ0E7QUFDQSxLQU5BO0FBUUEsR0FkQTtBQWdCQSxDLENBR0E7OztBQUVBLFNBQUFJLEtBQUEsR0FBQTtBQUNBLE1BQUFDLElBQUEsR0FBQUMsUUFBQSxDQUFBQyxhQUFBLENBQUEsYUFBQSxDQUFBO0FBQ0EsTUFB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QUEsVUFBQUMsSUFBQSxFQUFBZ0YsQ0FBQSxFQUFBO0FBQ0EsV0FBQSxJQUFBQyxHQUFBLElBQUF2QyxJQUFBLEVBQUE7QUFDQSxZQUFBMUMsSUFBQSxDQUFBRyxTQUFBLENBQUErRSxRQUFBLENBQUFELEdBQUEsQ0FBQSxFQUFBO0FBQ0F2QyxVQUFBQSxJQUFBLENBQUF1QyxHQUFBLENBQUEsR0FBQWpGLElBQUEsQ0FBQU8sS0FBQTtBQUNBO0FBQ0E7O0FBRUFrRSxNQUFBQSxTQUFBLENBQUF6RSxJQUFBLENBQUE7QUFDQSxLQVJBO0FBU0E4RCxJQUFBQSxRQUFBO0FBQ0E7O0FBR0EsV0FBQVcsU0FBQSxDQUFBekUsSUFBQSxFQUFBO0FBQ0FBLElBQUFBLElBQUEsQ0FBQU8sS0FBQSxHQUFBLEVBQUE7QUFDQSxRQUFBbUUsUUFBQSxHQUFBMUUsSUFBQSxDQUFBRSxVQUFBO0FBQ0F3RSxJQUFBQSxRQUFBLENBQUF2RSxTQUFBLENBQUFFLE1BQUEsQ0FBQSxPQUFBO0FBQ0E7QUFHQTs7QUFFQThFLFNBQUEiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIiLCJmdW5jdGlvbiBmb3JtX2ZvY3VzKGZvcm0pe1xyXG5cdGxldCBpbnB1dHMgPSBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJyk7XHJcblxyXG5cdGlucHV0cy5mb3JFYWNoKCBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICBpdGVtLm9uZm9jdXMgPSAoKT0+e1xyXG4gICAgICBpdGVtLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnZm9jdXMnKTtcclxuICAgICAgaXRlbS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ19lcnJvcicpO1xyXG4gICAgfVxyXG5cclxuICAgIGl0ZW0ub25ibHVyID0gKCk9PntcclxuICAgICAgaWYoaXRlbS52YWx1ZS5sZW5ndGggPj0gMSl7XHJcbiAgICAgICAgaXRlbS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2ZvY3VzJyk7XHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdmb2N1cycpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gIH0pXHJcblxyXG59XHJcblxyXG5cclxuLy8g0LLRi9C30L7QsiDRhNGD0L3QutGG0LjQuFxyXG5cclxuZnVuY3Rpb24gZm9ybXMoKXtcclxuXHRsZXQgam9pbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qb2luX19mb3JtJyk7XHJcblx0bGV0IGNyZWF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jcmVhdGVfX2Zvcm0nKTtcclxuXHJcblx0Zm9ybV9mb2N1cyhqb2luKTtcclxuXHRmb3JtX2ZvY3VzKGNyZWF0ZSk7XHJcbn1cclxuZm9ybXMoKTsiLCJcclxubGV0IHBhZ2VzID0ge1xyXG5cdGJhc2U6IHRydWUsXHJcblx0Z2FtZTogZmFsc2UsXHJcblx0Y3JlYXRlOiBmYWxzZSxcclxuXHRqb2luOiBmYWxzZSxcdFxyXG5cdHdhaXRpbmc6IGZhbHNlLFxyXG59XHJcblxyXG5jb25zdCBsb2NhdGlvblJlc29sdmVyID0gKGxvY2F0aW9uKT0+e1xyXG5cdHN3aXRjaCAobG9jYXRpb24pe1xyXG5cdFx0Y2FzZSBcIi9cIjpcclxuXHRcdFx0cGFnZUFjdGl2ZShsb2NhdGlvbilcclxuXHRcdFx0O1xyXG5cdFx0XHRicmVha1xyXG5cdFx0Y2FzZSBcIiMvY3JlYXRlXCI6XHJcblx0XHRcdHBhZ2VBY3RpdmUobG9jYXRpb24pXHJcblx0XHRcdDtcclxuXHRcdFx0YnJlYWtcclxuXHRcdGNhc2UgXCIjL2pvaW5cIjpcclxuXHRcdFx0cGFnZUFjdGl2ZShsb2NhdGlvbilcclxuXHRcdFx0O1xyXG5cdFx0XHRicmVha1xyXG5cdFx0Y2FzZSBcIiMvd2FpdGluZ1wiOlxyXG5cdFx0XHRwYWdlQWN0aXZlKGxvY2F0aW9uKVxyXG5cdFx0XHQ7XHJcblx0XHRcdGJyZWFrXHJcblx0XHRjYXNlIFwiIy9nYW1lXCI6XHJcblx0XHRcdHBhZ2VBY3RpdmUobG9jYXRpb24pXHJcblx0XHRcdDtcclxuXHRcdFx0YnJlYWtcclxuXHRcdFxyXG5cdH1cclxufVxyXG5cclxuXHJcblxyXG5mdW5jdGlvbiBjaGVja0hhc2goKXtcdFxyXG5cdGNvbnN0IGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XHJcblx0aWYobG9jYXRpb24pe1xyXG5cdFx0bG9jYXRpb25SZXNvbHZlcihsb2NhdGlvbilcdFx0XHJcblx0fVxyXG5cdGlmKHdpbmRvdy5sb2NhdGlvbi5oYXNoID09IFwiXCIgfHwgd2luZG93LmxvY2F0aW9uLmhhc2ggPT0gXCIvXCIpe1xyXG5cdFx0bGV0IGJhc2VfcGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5iYXNlYCk7XHJcblx0XHRmb3IobGV0IGl0ZW0gaW4gcGFnZXMpe1xyXG5cdFx0XHRsZXQgcGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2l0ZW19YCk7XHJcblx0XHRcdGlmKHBhZ2UgPT0gYmFzZV9wYWdlKXtcclxuXHRcdFx0XHRwYWdlLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG5cdFx0XHR9ZWxzZXtcclxuXHRcdFx0XHRwYWdlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbndpbmRvdy5vbmxvYWQgPSAoKT0+e1xyXG5cdGNoZWNrSGFzaCgpO1xyXG59XHJcblxyXG5cclxuLy8gaGFzaCB3YXRjaGVyXHJcblxyXG53aW5kb3cub25oYXNoY2hhbmdlID0gKCk9PntcclxuXHRzZXRUaW1lb3V0KCgpPT57XHRcdFxyXG5cdFx0Y2hlY2tIYXNoKCk7XHJcblx0fSwgMTAwKVxyXG59XHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIHBhZ2VBY3RpdmUobG9jYXRpb24pe1xyXG5cdGxldCBuYW1lID0gbG9jYXRpb24uc3Vic3RyKDIpO1xyXG5cdGxldCBwYWdlX2FjdGl2ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke25hbWV9YCk7XHJcblx0XHRcclxuXHRmb3IobGV0IGl0ZW0gaW4gcGFnZXMpe1xyXG5cdFx0bGV0IHBhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpdGVtfWApO1xyXG5cdFx0aWYocGFnZSA9PSBwYWdlX2FjdGl2ZSl7XHJcblx0XHRcdHBhZ2Uuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcblx0XHR9ZWxzZXtcclxuXHRcdFx0cGFnZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuXHJcbi8vIGJ0biAtIGJhY2tcclxuXHJcblxyXG5sZXQgYnRuc19iYWNrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJhY2snKTtcclxuXHJcbmJ0bnNfYmFjay5mb3JFYWNoKChidG4pPT57XHJcblx0YnRuLm9uY2xpY2sgPSAoKT0+e1xyXG5cdFx0d2luZG93LmxvY2F0aW9uLmhhc2ggPSAnJ1xyXG5cdH1cclxufSlcclxuXHJcbiIsIiIsImZ1bmN0aW9uIHdhdGluZ19nZXQoKXtcclxuXHJcbiAgY29uc3QgYmFzZVVSTCA9ICdodHRwOi8vMy4xMjIuMjA2LjYzL2FwaS92MS9nYW1lX2luZm8nO1xyXG4gIC8vY29uc3QgYmFzZVVSTCA9ICdodHRwczovL2pzb25wbGFjZWhvbGRlci50eXBpY29kZS5jb20vcG9zdHMnO1xyXG5cclxuXHJcbiAgZnVuY3Rpb24gc2VuZFJlcXVlc3QobWV0aG9kLCB1cmwsIGJvZHkgPSBudWxsKXtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PntcclxuICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcblxyXG4gICAgICB4aHIub3BlbihtZXRob2QsIHVybCk7XHJcbiAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnanNvbic7XHJcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXHJcblxyXG4gICAgICB4aHIub25sb2FkID0gKCk9PntcclxuICAgICAgICBpZih4aHIuc3RhdHVzID49IDQwMCl7XHJcbiAgICAgICAgICByZWplY3QoeGhyLnJlc3BvbnNlKVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2UpXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB4aHIub25lcnJvciA9ICgpPT57XHJcbiAgICAgICAgcmVqZWN0KHhoci5yZXNwb25zZSlcclxuICAgICAgfVxyXG4gICAgICB4aHIuc2VuZCggSlNPTi5zdHJpbmdpZnkoYm9keSkpO1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGNvbnN0IGJvZHkgPSB7XHJcbiAgICByb29tX2lkOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncm9vbV9pZCcpLFxyXG4gIH1cclxuXHJcbiAgY29uc29sZS5sb2cobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Jvb21faWQnKSk7XHJcblxyXG5cclxuICBmdW5jdGlvbiBzZW5kX3JlcSgpe1xyXG4gICAgc2VuZFJlcXVlc3QoJ0dFVCcsIGJhc2VVUkwsIGJvZHkpXHJcbiAgICAgIC50aGVuKGRhdGEgPT4gY29uc29sZS5sb2coZGF0YSkpXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7Y29uc29sZS5sb2coZXJyKTt9KVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gbmV4dF9wYWdlKGRhdGEpe1xyXG4gIFx0aWYoZGF0YS5tZXNzYWdlID09IFwiU3VjY2Vzc2Z1bGx5IGNyZWF0ZWRcIilcdHtcclxuICBcdFx0d2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIy93YWl0aW5nJ1xyXG4gIFx0fVxyXG4gIH1cclxuXHJcblxyXG4gIGxldCBzdGFydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdGFydC1nYW1lJyk7XHJcbiAgc3RhcnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmb3JtU2VuZCk7XHJcblxyXG4gIGZ1bmN0aW9uIGZvcm1TZW5kKGUpe1xyXG4gIFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgc2VuZF9yZXEoKTtcclxuICB9XHJcblxyXG5cclxuICBmdW5jdGlvbiBmb3JtQ2xlYXIoaXRlbSl7XHJcbiAgICBpdGVtLnZhbHVlID0gJyc7XHJcbiAgICBsZXQgZWxfc3R5bGUgPSBpdGVtLnBhcmVudE5vZGU7XHJcbiAgICBlbF9zdHlsZS5jbGFzc0xpc3QucmVtb3ZlKCdmb2N1cycpO1xyXG4gIH1cclxuXHJcblxyXG59XHJcblxyXG53YXRpbmdfZ2V0KCk7XHJcblxyXG4iLCJmdW5jdGlvbiBmb3JtX2NyZWF0ZSgpe1xyXG5cclxuICBjb25zdCBiYXNlVVJMID0gJ2h0dHA6Ly8zLjEyMi4yMDYuNjMvYXBpL3YxL3Jvb21fY3JlYXRlJztcclxuICAvL2NvbnN0IGJhc2VVUkwgPSAnaHR0cHM6Ly9qc29ucGxhY2Vob2xkZXIudHlwaWNvZGUuY29tL3Bvc3RzJztcclxuXHJcblxyXG4gIGZ1bmN0aW9uIHNlbmRSZXF1ZXN0KG1ldGhvZCwgdXJsLCBib2R5ID0gbnVsbCl7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT57XHJcbiAgICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG5cclxuICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwpO1xyXG4gICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2pzb24nO1xyXG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKVxyXG5cclxuICAgICAgeGhyLm9ubG9hZCA9ICgpPT57XHJcbiAgICAgICAgaWYoeGhyLnN0YXR1cyA+PSA0MDApe1xyXG4gICAgICAgICAgcmVqZWN0KHhoci5yZXNwb25zZSlcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlKVxyXG4gICAgICAgICAgbmV4dF9wYWdlKHhoci5yZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB4aHIub25lcnJvciA9ICgpPT57XHJcbiAgICAgICAgcmVqZWN0KHhoci5yZXNwb25zZSlcclxuICAgICAgfVxyXG4gICAgICB4aHIuc2VuZCggSlNPTi5zdHJpbmdpZnkoYm9keSkpO1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGNvbnN0IGJvZHkgPSB7XHJcbiAgICBpbml0aWF0b3I6ICcnLFxyXG4gICAgcGFzc3dvcmQ6ICcnLFxyXG4gICAgbG9jYXRpb246ICcnLFxyXG4gICAgcXVhbnRpdHlfcGxheWVyczogJycsXHJcbiAgfVxyXG5cclxuXHJcbiAgZnVuY3Rpb24gc2VuZF9yZXEoKXtcclxuICAgIHNlbmRSZXF1ZXN0KCdQT1NUJywgYmFzZVVSTCwgYm9keSlcclxuICAgICAgLnRoZW4oZGF0YSA9PiBjb25zb2xlLmxvZyhkYXRhKSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtjb25zb2xlLmxvZyhlcnIpO30pXHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBuZXh0X3BhZ2UoZGF0YSl7XHJcbiAgXHRpZihkYXRhLm1lc3NhZ2UgPT0gXCJTdWNjZXNzZnVsbHkgY3JlYXRlZFwiKVx0e1xyXG4gIFx0XHR3aW5kb3cubG9jYXRpb24uaGFzaCA9ICcjL3dhaXRpbmcnXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdyb29tX2lkJywgYCR7ZGF0YS5yb29tX2lkfWApXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwYXNzd29yZCcsIGAke2RhdGEucGFzc3dvcmR9YClcclxuICBcdH1cclxuICB9XHJcblxyXG5cclxuICBsZXQgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jcmVhdGVfX2Zvcm0nKTtcclxuXHJcbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmb3JtU2VuZCk7XHJcblxyXG4gIGZ1bmN0aW9uIGZvcm1TZW5kKGUpe1xyXG4gIFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFx0Zm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcclxuICBcdFx0Zm9yKGxldCBpbnAgaW4gYm9keSl7XHJcbiAgXHRcdFx0aWYoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoaW5wKSl7XHJcbiAgXHRcdFx0XHRib2R5W2lucF0gPSBpdGVtLnZhbHVlO1xyXG4gIFx0XHRcdH1cclxuICBcdFx0fVxyXG4gIFx0XHRmb3JtQ2xlYXIoaXRlbSk7XHJcbiAgICB9KVxyXG4gICAgc2VuZF9yZXEoKTtcclxuICB9XHJcblxyXG5cclxuICBmdW5jdGlvbiBmb3JtQ2xlYXIoaXRlbSl7XHJcbiAgICBpdGVtLnZhbHVlID0gJyc7XHJcbiAgICBsZXQgZWxfc3R5bGUgPSBpdGVtLnBhcmVudE5vZGU7XHJcbiAgICBlbF9zdHlsZS5jbGFzc0xpc3QucmVtb3ZlKCdmb2N1cycpO1xyXG4gIH1cclxuXHJcblxyXG59XHJcblxyXG5mb3JtX2NyZWF0ZSgpO1xyXG5cclxuIiwiZnVuY3Rpb24gZm9ybV9qb2luKCl7XHJcblxyXG4gIGNvbnN0IGJhc2VVUkwgPSAnaHR0cDovLzMuMTIyLjIwNi42My9hcGkvdjEvcm9vbV9jb25uZWN0JztcclxuXHJcbiBmdW5jdGlvbiBzZW5kUmVxdWVzdChtZXRob2QsIHVybCwgYm9keSA9IG51bGwpe1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+e1xyXG4gICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuXHJcbiAgICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsKTtcclxuICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJztcclxuICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcclxuXHJcbiAgICAgIHhoci5vbmxvYWQgPSAoKT0+e1xyXG4gICAgICAgIGlmKHhoci5zdGF0dXMgPj0gNDAwKXtcclxuICAgICAgICAgIHJlamVjdCh4aHIucmVzcG9uc2UpXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICByZXNvbHZlKHhoci5yZXNwb25zZSlcclxuICAgICAgICAgIG5leHRfcGFnZSh4aHIucmVzcG9uc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgeGhyLm9uZXJyb3IgPSAoKT0+e1xyXG4gICAgICAgIHJlamVjdCh4aHIucmVzcG9uc2UpXHJcbiAgICAgIH1cclxuICAgICAgeGhyLnNlbmQoIEpTT04uc3RyaW5naWZ5KGJvZHkpKTtcclxuICAgIH0pXHJcbiAgfVxyXG4gIFxyXG4gIGNvbnN0IGJvZHkgPSB7XHJcbiAgICBuaWNrbmFtZTogJycsXHJcbiAgICBwYXNzd29yZDogJycsXHJcbiAgICByb29tOiAnJyxcclxuICB9XHJcblxyXG5cclxuICBmdW5jdGlvbiBzZW5kX3JlcSgpe1xyXG4gICAgc2VuZFJlcXVlc3QoJ1BPU1QnLCBiYXNlVVJMLCBib2R5KVxyXG4gICAgICAudGhlbihkYXRhID0+IGNvbnNvbGUubG9nKGRhdGEpKVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge2NvbnNvbGUubG9nKGVycik7fSlcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG5leHRfcGFnZShkYXRhKXtcclxuICBcdGlmKGRhdGEubWVzc2FnZSA9PSBcIlN1Y2Nlc3NmdWxseSBjcmVhdGVkXCIpXHR7XHJcbiAgXHRcdHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJyMvd2FpdGluZydcclxuICBcdH1cclxuICB9XHJcblxyXG5cclxuICBsZXQgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qb2luX19mb3JtJyk7XHJcblxyXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZm9ybVNlbmQpO1xyXG5cclxuICBmdW5jdGlvbiBmb3JtU2VuZChlKXtcclxuICBcdGUucHJldmVudERlZmF1bHQoKTtcclxuICBcdGZvcm0ucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT1cInRleHRcIl0nKS5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XHJcbiAgXHRcdGZvcihsZXQgaW5wIGluIGJvZHkpe1xyXG4gIFx0XHRcdGlmKGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKGlucCkpe1xyXG4gIFx0XHRcdFx0Ym9keVtpbnBdID0gaXRlbS52YWx1ZTtcclxuICBcdFx0XHR9XHJcbiAgXHRcdH1cclxuXHJcbiAgXHRcdGZvcm1DbGVhcihpdGVtKTtcclxuICAgIH0pXHJcbiAgICBzZW5kX3JlcSgpO1xyXG4gIH1cclxuXHJcblxyXG4gIGZ1bmN0aW9uIGZvcm1DbGVhcihpdGVtKXtcclxuICAgIGl0ZW0udmFsdWUgPSAnJztcclxuICAgIGxldCBlbF9zdHlsZSA9IGl0ZW0ucGFyZW50Tm9kZTtcclxuICAgIGVsX3N0eWxlLmNsYXNzTGlzdC5yZW1vdmUoJ2ZvY3VzJyk7XHJcbiAgfVxyXG5cclxuXHJcbn1cclxuXHJcbmZvcm1fam9pbigpO1xyXG4iXX0=
